<div class="container mx-auto p-4 max-w-2xl">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">献立相談</h1>
    <%= link_to "ホーム", home_path, class: "btn btn-ghost" %>
  </div>

  <%= form_with url: meal_searches_path, method: :post, local: true, class: "space-y-6" do |f| %>

    <!-- 自炊 or 中食 -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-semibold">自炊 or 中食</span>
      </label>
      <div class="flex gap-4">
        <label class="label cursor-pointer gap-2">
          <%= f.radio_button :meal_mode, "home_cooking", class: "radio radio-primary" %>
          <span class="label-text">自炊</span>
        </label>
        <label class="label cursor-pointer gap-2">
          <%= f.radio_button :meal_mode, "ready_made", class: "radio radio-primary" %>
          <span class="label-text">中食</span>
        </label>
      </div>
    </div>

    <!-- 買い物 or 家にある -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-semibold">買い物 or 家にある</span>
      </label>
      <div class="flex gap-4">
        <label class="label cursor-pointer gap-2">
          <%= f.radio_button :cook_context, "shopping", class: "radio radio-primary" %>
          <span class="label-text">買い物</span>
        </label>
        <label class="label cursor-pointer gap-2">
          <%= f.radio_button :cook_context, "at_home", class: "radio radio-primary" %>
          <span class="label-text">家にある</span>
        </label>
      </div>
    </div>

    <!-- 所要時間 -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-semibold">所要時間（分）</span>
      </label>
      <%= f.select :required_minutes,
                   [10, 20, 30, 45, 60],
                   { prompt: "選択してください" },
                   { class: "select select-bordered w-full" } %>
    </div>

    <!-- ジャンル -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-semibold">ジャンル</span>
      </label>
      <%= f.collection_select :genre_id,
                              @genres,
                              :id,
                              :label,
                              { prompt: "選択してください" },
                              { class: "select select-bordered w-full" } %>
    </div>

    <!-- 気分タグ -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-semibold">気分</span>
      </label>
      <%= f.collection_select :mood_tag_id,
                              @moods,
                              :id,
                              :label,
                              { prompt: "選択してください" },
                              { class: "select select-bordered w-full" } %>
    </div>

    <!-- 送信ボタン（無効化） -->
    <div class="form-control mt-6">
      <%= f.submit "候補を見る", class: "btn btn-primary w-full" %>
    </div>

  <% end %>
  <% if @candidates.present? %>
      <div class="mt-8">
        <h2 class="text-xl font-bold mb-4">おすすめの候補</h2>
        <div class="grid gap-4">
          <% @candidates.each do |candidate| %>
            <div class="card bg-base-100 border border-base-300">
              <div class="card-body">
                <h3 class="card-title"><%= candidate.name %></h3>
                <p class="text-sm text-gray-600">
                  ジャンル: <%= candidate.genre.label %>
                </p>
                <div class="card-actions justify-end mt-2">
                  <%= link_to "Google で検索",
                              "https://www.google.com/search?q=#{CGI.escape(candidate.name + ' レシピ')}",
                              target: "_blank",
                              rel: "noopener noreferrer",
                              class: "btn btn-sm btn-outline btn-primary" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
</div>
