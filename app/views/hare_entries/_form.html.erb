<%= form_with model: hare_entry, local: true, class: "space-y-6" do |f| %>
  <%# エラーメッセージ %>
  <% if hare_entry.errors.any? %>
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
      <p class="font-bold text-red-700 mb-2"><%= hare_entry.errors.count %>件の入力エラーがあります</p>
      <ul class="list-disc list-inside text-red-600 text-sm space-y-1">
        <% hare_entry.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# 内容入力 %>
  <div>
    <%= f.label :body, "内容", class: "block text-base font-bold text-gray-800 mb-3" %>
    <%= f.text_area :body, class: "w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 focus:bg-white resize-none text-gray-900 placeholder-gray-500", rows: 6, maxlength: 280, placeholder: "今日のごはんで「ちょっと特別」だったことは？（280文字まで）" %>
  </div>

  <%# 日付入力 %>
  <div>
    <%= f.label :occurred_on, "日付", class: "block text-base font-bold text-gray-800 mb-3" %>
    <%= f.date_field :occurred_on, class: "w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 focus:bg-white text-gray-900" %>
  </div>

  <%# タグ選択 %>
  <% if local_assigns[:hare_tags]&.any? %>
    <div>
      <%= f.label :hare_tag_ids, "タグ（複数選択可）", class: "block text-base font-bold text-gray-800 mb-3" %>
      <div class="flex flex-wrap gap-3">
        <%= f.collection_check_boxes(:hare_tag_ids, hare_tags, :id, :label) do |b| %>
          <label class="flex items-center gap-2 px-4 py-2 bg-gray-50 hover:bg-orange-50 rounded-full cursor-pointer transition-colors border-2 border-gray-300 hover:border-orange-400">
            <%= b.check_box(class: "rounded text-orange-500 focus:ring-orange-400") %>
            <span class="text-sm font-medium text-gray-800"><%= b.text %></span>
          </label>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# 公開設定 %>
  <div>
    <%= f.label :visibility, "公開設定", class: "block text-base font-bold text-gray-800 mb-3" %>
    <%= f.select :visibility, HareEntry.visibilities.keys.map { |k| [I18n.t("enums.hare_entry.visibility.#{k}", default: k), k] }, {}, class: "w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 focus:bg-white text-gray-900" %>
  </div>

  <%# 写真アップロード %>
  <div data-controller="image-preview">
    <%= f.label :photo, "写真", class: "block text-base font-bold text-gray-800 mb-3" %>
    <%= f.file_field :photo, accept: "image/jpeg,image/png,image/webp", class: "w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 focus:bg-white text-gray-900", data: { image_preview_target: "input", action: "change->image-preview#preview" } %>
    <p class="text-sm text-gray-600 mt-2">JPEG、PNG、WebP形式（最大5MB）</p>

    <%# プレビューエリア %>
    <div data-image-preview-target="previewContainer" class="mt-4 hidden">
      <img data-image-preview-target="preview" class="max-w-md rounded-xl border-2 border-gray-300 shadow-sm">
    </div>

    <%# 既存の写真表示と削除チェックボックス %>
    <% if hare_entry.photo.attached? %>
      <div class="mt-4">
        <p class="text-sm font-bold text-gray-800 mb-2">現在の写真</p>
        <%= image_tag hare_entry.photo.variant(resize_to_limit: [200, 200]), class: "max-w-md rounded-xl border-2 border-gray-300 shadow-sm" %>
        <label class="flex items-center gap-2 mt-3">
          <%= f.check_box :remove_photo, class: "rounded text-red-500 focus:ring-red-400" %>
          <span class="text-sm font-medium text-gray-800">写真を削除する</span>
        </label>
      </div>
    <% end %>
  </div>

  <%# ボタン %>
  <div class="flex gap-4 pt-4">
    <%= f.submit submit_label, class: "bg-gradient-to-r from-orange-400 to-orange-300 text-white px-8 py-3 rounded-full font-semibold hover:from-orange-500 hover:to-orange-400 transition-colors shadow-md" %>
    <%= link_to "キャンセル", cancel_path, class: "px-8 py-3 text-gray-600 hover:text-gray-800 font-semibold" %>
  </div>
<% end %>
